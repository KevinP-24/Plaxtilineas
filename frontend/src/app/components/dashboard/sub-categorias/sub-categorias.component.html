<div class="admin-content-wrapper">
  <!-- Contenido principal -->
  <main class="admin-main-content">
    <!-- Header -->
    <div class="admin-content-header">
      <div class="header-content">
        <h1 class="page-title">
          <fa-icon [icon]="faFolder" class="title-icon"></fa-icon>
          Gestión de Subcategorías
        </h1>
        <p class="page-subtitle">Administra las subcategorías del catálogo</p>
      </div>
      <button class="back-to-dashboard" (click)="volverAlDashboard()">
        <fa-icon [icon]="faArrowLeft"></fa-icon>
        <span>Volver al Dashboard</span>
      </button>
    </div>

    <!-- Card: Crear nueva subcategoría -->
    <section class="admin-card create-card">
      <div class="card-header">
        <h2 class="card-title">
          <fa-icon [icon]="faPlus" class="card-icon"></fa-icon>
          Crear Nueva Subcategoría
        </h2>
      </div>
      <div class="card-body">
        <form #formSubcategoria="ngForm" (ngSubmit)="crearSubcategoria()" class="subcategory-form">
          <div class="form-row">
            <div class="form-group">
              <label for="categoria_id" class="form-label">
                <fa-icon [icon]="faFolderOpen"></fa-icon>
                Categoría
              </label>
              <select
                id="categoria_id"
                name="categoria_id"
                [(ngModel)]="subcategoria.categoria_id"
                required
                class="form-select"
              >
                <option value="">Selecciona una categoría</option>
                <option *ngFor="let cat of categorias" [value]="cat.id">
                  {{ cat.nombre }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="nombre" class="form-label">
                <fa-icon [icon]="faTag"></fa-icon>
                Nombre de la subcategoría
              </label>
              <input
                type="text"
                id="nombre"
                name="nombre"
                [(ngModel)]="subcategoria.nombre"
                placeholder="Ej: Smartphones, Camisetas, Sofás..."
                required
                class="form-input"
              />
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="!formSubcategoria.valid">
              <fa-icon [icon]="faPlus"></fa-icon>
              Crear Subcategoría
            </button>
            <button type="button" class="btn-secondary" (click)="limpiarFormulario()">
              <fa-icon [icon]="faEraser"></fa-icon>
              Limpiar
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Card: Lista de subcategorías -->
    <section class="admin-card list-card">
      <div class="card-header">
        <h2 class="card-title">
          <fa-icon [icon]="faList" class="card-icon"></fa-icon>
          Lista de Subcategorías
          <span class="badge">{{ totalSubcategorias }}</span>
        </h2>
        
        <!-- Controles de búsqueda y paginación superior -->
        <div class="table-controls">
          <div class="search-box">
            <fa-icon [icon]="faSearch" class="search-icon"></fa-icon>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (ngModelChange)="filtrarSubcategorias()"
              placeholder="Buscar subcategoría..."
              class="search-input"
            />
          </div>
          
          <div class="pagination-info">
            Mostrando {{ getItemsMostrados() }} de {{ totalSubcategorias }} subcategorías
          </div>
        </div>
      </div>

      <div class="card-body">
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th width="80">ID</th>
                <th>Nombre</th>
                <th>Categoría</th>
                <th width="180">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let sub of subcategoriasPaginadas" [class.editing]="sub.editando">
                <td class="id-cell">
                  <span class="badge-id">#{{ sub.id }}</span>
                </td>

                <td>
                  <div class="name-cell" *ngIf="!sub.editando">
                    {{ sub.nombre }}
                  </div>
                  <input
                    *ngIf="sub.editando"
                    type="text"
                    [(ngModel)]="sub.nombre"
                    class="edit-input"
                    placeholder="Nombre de subcategoría"
                  />
                </td>

                <td>
                  <div *ngIf="!sub.editando" class="category-cell">
                    {{ getNombreCategoria(sub.categoria_id) }}
                  </div>
                  <select
                    *ngIf="sub.editando"
                    [(ngModel)]="sub.categoria_id"
                    class="edit-select"
                  >
                    <option *ngFor="let cat of categorias" [value]="cat.id">
                      {{ cat.nombre }}
                    </option>
                  </select>
                </td>

                <td>
                  <div class="action-buttons">
                    <ng-container *ngIf="!sub.editando">
                      <button class="btn-action edit" (click)="sub.editando = true" title="Editar">
                        <fa-icon [icon]="faEdit"></fa-icon>
                      </button>
                      <button class="btn-action delete" (click)="eliminarSubcategoria(sub.id)" title="Eliminar">
                        <fa-icon [icon]="faTrashAlt"></fa-icon>
                      </button>
                    </ng-container>
                    <ng-container *ngIf="sub.editando">
                      <button class="btn-action save" (click)="actualizarSubcategoria(sub)" title="Guardar">
                        <fa-icon [icon]="faSave"></fa-icon>
                      </button>
                      <button class="btn-action cancel" (click)="cancelarEdicion(sub)" title="Cancelar">
                        <fa-icon [icon]="faTimes"></fa-icon>
                      </button>
                    </ng-container>
                  </div>
                </td>
              </tr>
              
              <tr *ngIf="subcategoriasPaginadas.length === 0">
                <td colspan="4" class="no-data">
                  <fa-icon [icon]="faInbox" class="no-data-icon"></fa-icon>
                  <p>No se encontraron subcategorías</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginación -->
        <div class="pagination" *ngIf="totalPaginas > 1">
          <button 
            class="pagination-btn" 
            (click)="cambiarPagina(paginaActual - 1)"
            [disabled]="paginaActual === 1"
          >
            <fa-icon [icon]="faChevronLeft"></fa-icon>
          </button>
          
          <div class="pagination-numbers">
            <button
              *ngFor="let pagina of getRangoPaginas()"
              class="pagination-number"
              [class.active]="pagina === paginaActual"
              (click)="cambiarPagina(pagina)"
            >
              {{ pagina }}
            </button>
          </div>
          
          <button 
            class="pagination-btn" 
            (click)="cambiarPagina(paginaActual + 1)"
            [disabled]="paginaActual === totalPaginas"
          >
            <fa-icon [icon]="faChevronRight"></fa-icon>
          </button>
        </div>

        <!-- Selector de items por página -->
        <div class="page-size-selector">
          <label for="pageSize">
            <fa-icon [icon]="faListAlt"></fa-icon>
            Mostrar:
          </label>
          <select 
            id="pageSize" 
            [(ngModel)]="itemsPorPagina" 
            (ngModelChange)="cambiarItemsPorPagina()"
            class="page-size-select"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
          <span class="selector-label">subcategorías por página</span>
        </div>
      </div>
    </section>
  </main>
</div>