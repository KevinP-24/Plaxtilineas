<div class="admin-dashboard-container">
  <!-- Header del Dashboard -->
  <header class="admin-dashboard-header">
    <div class="admin-header-content">
      <img src="https://res.cloudinary.com/dsv1gdgya/image/upload/v1766438846/plaxtilineas_mujcoh.png" alt="Logo" class="admin-logo" />
      <div class="admin-header-text">
        <h1 class="admin-title">Panel de Administraci√≥n</h1>
        <p class="admin-subtitle">Gestiona productos, categor√≠as y subcategor√≠as de forma r√°pida y eficiente.
              Accede a todas las herramientas desde el men√∫ lateral</p>
      </div>
    </div>
    <button class="admin-logout-btn" (click)="logout()" title="Cerrar sesi√≥n">
      <fa-icon [icon]="faSignOutAlt" class="logout-icon"></fa-icon>
      <span>Cerrar Sesi√≥n</span>
    </button>
  </header>

  <!-- Contenido principal -->
  <div class="admin-content-wrapper">
    <!-- Men√∫ de navegaci√≥n lateral -->
    <nav class="admin-sidebar">
      <ul class="admin-menu">
        <li class="menu-item" [class.active]="estaEnInicio">
          <a routerLink="/admin" class="menu-link">
            <fa-icon [icon]="faHome" class="menu-icon"></fa-icon>
            <span>Inicio</span>
          </a>
        </li>
        <li class="menu-item">
          <a routerLink="/admin/categorias" class="menu-link">
            <fa-icon [icon]="faFolderOpen" class="menu-icon"></fa-icon>
            <span>Categor√≠as</span>
          </a>
        </li>
        <li class="menu-item">
          <a routerLink="/admin/subcategorias" class="menu-link">
            <fa-icon [icon]="faFolder" class="menu-icon"></fa-icon>
            <span>Subcategor√≠as</span>
          </a>
        </li>
        <li class="menu-item">
          <a routerLink="/admin/productos" class="menu-link">
            <fa-icon [icon]="faBoxes" class="menu-icon"></fa-icon>
            <span>Productos</span>
          </a>
        </li>
        <li class="menu-item">
          <a routerLink="/admin/inventario" class="menu-link">
            <fa-icon [icon]="faWarehouse" class="menu-icon"></fa-icon>
            <span>Inventario</span>
          </a>
        </li>
        <li class="menu-item">
          <a routerLink="/admin/pqr-admin" class="menu-link">
            <fa-icon [icon]="faClipboardList" class="menu-icon"></fa-icon>
            <!-- Alternativa: faComments -->
            <span>PQR</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- √Årea de contenido -->
    <main class="admin-main-content">
      <!-- Bienvenida (solo visible en /admin) -->
      <div *ngIf="estaEnInicio" class="admin-welcome-section">
        
        <!-- Secci√≥n de Importaci√≥n de Productos -->
        <section class="admin-card import-section">
          <div class="import-header">
            <h2 class="card-title">
              <fa-icon [icon]="faDownload" class="section-icon"></fa-icon>
              Importar Productos desde Hostinger
            </h2>
            <p class="card-subtitle">Sincroniza productos desde la base de datos de Hostinger</p>
          </div>

          <!-- Mensajes de error y √©xito -->
          <div *ngIf="mensajeError" class="alert alert-error">
            {{ mensajeError }}
          </div>
          <div *ngIf="mensajeExito" class="alert alert-success">
            {{ mensajeExito }}
          </div>

          <!-- Botones de control -->
          <div class="import-controls">
            <button 
              class="import-btn import-btn-preview" 
              (click)="obtenerPreview()"
              [disabled]="cargandoPreview || cargandoEstadisticas || cargandoImportacion"
              title="Ver una vista previa de los productos a importar">
              <fa-icon [icon]="faEye"></fa-icon>
              <span *ngIf="!cargandoPreview">Ver Preview</span>
              <span *ngIf="cargandoPreview">Cargando...</span>
            </button>

            <button 
              class="import-btn import-btn-stats" 
              (click)="obtenerEstadisticas()"
              [disabled]="cargandoEstadisticas || cargandoPreview || cargandoImportacion"
              title="Ver estad√≠sticas de productos disponibles">
              <fa-icon [icon]="faChartBar"></fa-icon>
              <span *ngIf="!cargandoEstadisticas">Ver Estad√≠sticas</span>
              <span *ngIf="cargandoEstadisticas">Cargando...</span>
            </button>

            <button 
              class="import-btn import-btn-execute" 
              (click)="ejecutarImportacion()"
              [disabled]="cargandoImportacion || cargandoPreview || cargandoEstadisticas"
              title="Ejecutar importaci√≥n de todos los productos">
              <fa-icon [icon]="faDownload"></fa-icon>
              <span *ngIf="!cargandoImportacion">Ejecutar Importaci√≥n</span>
              <span *ngIf="cargandoImportacion">Importando...</span>
            </button>

            <button 
              class="import-btn import-btn-clear" 
              (click)="limpiarDatos()"
              [disabled]="!datosPreview && !datosEstadisticas && !respuestaImportacion"
              title="Limpiar datos mostrados">
              Limpiar
            </button>
          </div>

          <!-- Preview de Productos -->
          <div *ngIf="datosPreview" class="import-data-section preview-section">
            <h3 class="data-section-title">
              <fa-icon [icon]="faEye"></fa-icon>
              Vista Previa ({{ datosPreview.total_en_preview }} productos)
            </h3>
            <div class="products-preview-grid">
              <div *ngFor="let producto of datosPreview.productos" class="product-preview-card">
                <div *ngIf="producto.primera_imagen" class="product-preview-image">
                  <img [src]="producto.primera_imagen" [alt]="producto.name" />
                </div>
                <div class="product-preview-info">
                  <h4 class="product-name">{{ producto.name }}</h4>
                  <p class="product-cat">{{ producto.category || 'Sin categor√≠a' }}</p>
                  <p class="product-variants">üì¶ {{ producto.variantes_count }} variantes</p>
                  <p *ngIf="producto.primer_precio" class="product-price">üí∞ ${{ producto.primer_precio }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Estad√≠sticas -->
          <div *ngIf="datosEstadisticas" class="import-data-section stats-section">
            <h3 class="data-section-title">
              <fa-icon [icon]="faChartBar"></fa-icon>
              Estad√≠sticas
            </h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value">{{ datosEstadisticas.total_productos }}</div>
                <div class="stat-label">Total de Productos</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">{{ datosEstadisticas.productos_con_imagen }}</div>
                <div class="stat-label">Con Imagen</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">{{ datosEstadisticas.productos_con_variantes }}</div>
                <div class="stat-label">Con Variantes</div>
              </div>
            </div>
            <div *ngIf="datosEstadisticas.productos_por_categoria && datosEstadisticas.productos_por_categoria.length" class="categories-list">
              <h4>Productos por Categor√≠a:</h4>
              <ul>
                <li *ngFor="let cat of datosEstadisticas.productos_por_categoria">
                  <strong>{{ cat.category || '(sin categor√≠a)' }}:</strong> {{ cat.total }} productos
                </li>
              </ul>
            </div>
          </div>

          <!-- Resultado de Importaci√≥n -->
          <div *ngIf="respuestaImportacion" class="import-data-section result-section" 
               [class.success]="respuestaImportacion.errores === 0">
            <h3 class="data-section-title">
              <fa-icon [icon]="faDownload"></fa-icon>
              Resultado de Importaci√≥n
            </h3>
            <div class="result-summary">
              <div class="result-item success">
                <span class="result-label">Importados Exitosamente:</span>
                <span class="result-value">{{ respuestaImportacion.importados_exitosamente }}/{{ respuestaImportacion.total_procesados }}</span>
              </div>
              <div *ngIf="respuestaImportacion.duplicados_ignorados > 0" class="result-item warning">
                <span class="result-label">Duplicados Ignorados:</span>
                <span class="result-value">{{ respuestaImportacion.duplicados_ignorados }}</span>
              </div>
              <div *ngIf="respuestaImportacion.errores > 0" class="result-item error">
                <span class="result-label">Errores:</span>
                <span class="result-value">{{ respuestaImportacion.errores }}</span>
              </div>
            </div>

            <div *ngIf="respuestaImportacion.detalles_duplicados && respuestaImportacion.detalles_duplicados.length" class="details-section">
              <h4>Productos Duplicados ({{ respuestaImportacion.detalles_duplicados.length }})</h4>
              <ul class="details-list">
                <li *ngFor="let dup of respuestaImportacion.detalles_duplicados">
                  {{ dup.nombre }}
                </li>
              </ul>
            </div>

            <div *ngIf="respuestaImportacion.detalles_errores && respuestaImportacion.detalles_errores.length" class="details-section">
              <h4>Errores ({{ respuestaImportacion.detalles_errores.length }})</h4>
              <ul class="details-list">
                <li *ngFor="let err of respuestaImportacion.detalles_errores">
                  <strong>{{ err.nombre }}:</strong> {{ err.error }}
                </li>
              </ul>
            </div>
          </div>
        </section>
      
        <section class="admin-card quick-access-card">
          <h2 class="card-title">
            <fa-icon [icon]="faBolt" class="section-icon"></fa-icon>
            Acceso r√°pido
          </h2>
          <p class="card-subtitle">Navega r√°pidamente a las secciones principales</p>
          
          <div class="quick-access-grid">
            <a routerLink="/admin/categorias" class="access-card">
              <div class="access-icon-container">
                <fa-icon [icon]="faFolderOpen"></fa-icon>
              </div>
              <h3 class="access-title">Gestionar categor√≠as</h3>
              <p class="access-description">Organiza las categor√≠as principales del cat√°logo</p>
              <span class="access-link">Ir a categor√≠as ‚Üí</span>
            </a>
            
            <a routerLink="/admin/subcategorias" class="access-card">
              <div class="access-icon-container">
                <fa-icon [icon]="faFolder"></fa-icon>
              </div>
              <h3 class="access-title">Gestionar subcategor√≠as</h3>
              <p class="access-description">Administra las subdivisiones de cada categor√≠a</p>
              <span class="access-link">Ir a subcategor√≠as ‚Üí</span>
            </a>
            
            <a routerLink="/admin/productos" class="access-card">
              <div class="access-icon-container">
                <fa-icon [icon]="faBoxes"></fa-icon>
              </div>
              <h3 class="access-title">Gestionar productos</h3>
              <p class="access-description">Administra los productos del cat√°logo</p>
              <span class="access-link">Ir a productos ‚Üí</span>
            </a>

            <a routerLink="/admin/inventario" class="access-card">
              <div class="access-icon-container">
                <fa-icon [icon]="faWarehouse"></fa-icon>
              </div>
              <h3 class="access-title">Gestionar inventario</h3>
              <p class="access-description">Administra el inventario</p>
              <span class="access-link">Ir a inventario ‚Üí</span>
            </a>

            <a routerLink="/admin/pqr-admin" class="access-card">
              <div class="access-icon-container">
                <fa-icon [icon]="faClipboardList"></fa-icon>
              </div>
              <h3 class="access-title">Gestionar PQR</h3>
              <p class="access-description">Administra las PQRS</p>
              <span class="access-link">Ir a gestionador de PQR ‚Üí</span>
            </a>
          </div>
        </section>
      </div>

      <!-- Router outlet para vistas hijas -->
      <div class="router-outlet-container">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>