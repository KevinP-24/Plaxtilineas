<div class="menu-dropdown-wrapper" 
     (mouseenter)="onMouseEnter()" 
     (mouseleave)="onMouseLeave()">
  
  <!-- Trigger (el enlace Catálogo con icono) -->
  <a [routerLink]="['/productos']"
     class="dropdown-trigger nav-link" 
     (click)="onTriggerClick($event)"
     aria-label="Catálogo de productos">
    <!-- Icono de catálogo -->
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="nav-icon" viewBox="0 0 16 16">
      <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-2z"/>
      <path d="M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1zm9 1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V5z"/>
    </svg>
    <span class="nav-text">Catálogo</span>
    <span class="dropdown-arrow">▼</span>
  </a>

  <!-- Menú desplegable -->
  <div class="dropdown-menu" [class.visible]="menuVisible">
    <div class="dropdown-content">
      <!-- Columnas de categorías -->
      <div class="categorias-grid">
        <div class="categoria-column" 
             *ngFor="let categoria of categorias"
             (mouseenter)="onCategoriaHover(categoria.id)"
             (mouseleave)="onCategoriaLeave()"
             [class.active]="hoveredCategoriaId === categoria.id">
          
          <!-- Encabezado de categoría con icono -->
          <div class="categoria-header">
            <span class="categoria-icon" *ngIf="categoria.imagen_url">
              <img [src]="categoria.imagen_url" [alt]="categoria.nombre" loading="lazy">
            </span>
            <span class="categoria-name">{{ categoria.nombre }}</span>
          </div>

          <!-- Subcategorías -->
          <div class="subcategorias" *ngIf="categoria.subcategorias && categoria.subcategorias.length > 0">
            <a *ngFor="let subcategoria of categoria.subcategorias"
               [routerLink]="['/productos']"
               [queryParams]="{ categoria_id: categoria.id, subcategoria_id: subcategoria.id }"
               (click)="onSubcategoriaSelect(subcategoria.id); closeMenu()"
               class="subcategoria-link">
              <span class="subcategoria-dot"></span>
              {{ subcategoria.nombre }}
            </a>
          </div>

          <!-- Mensaje si no hay subcategorías -->
          <div class="no-subcategorias" *ngIf="!categoria.subcategorias || categoria.subcategorias.length === 0">
            <span class="no-subcategorias-text">Sin subcategorías</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay para cerrar menú -->
  <div class="dropdown-overlay" 
       [class.active]="menuVisible" 
       (click)="onMouseLeave()"></div>
</div>