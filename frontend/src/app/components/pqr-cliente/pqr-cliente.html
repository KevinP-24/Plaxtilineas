<div class="seccion-pqr">
  <div class="pqr-container">
    
    <!-- Header -->
    <div class="pqr-header">
      <h1 class="pqr-title">PQR - Peticiones, Quejas, Reclamos y Sugerencias</h1>
      <div class="pqr-subtitle">
        <p>En PLAXTILINEAS nos importa tu opini√≥n. ¬øTienes alguna petici√≥n, queja, reclamo o sugerencia? Estamos aqu√≠ para escucharte y ayudarte.</p>
        <p><strong>¬°Tu voz es importante para nosotros!</strong></p>
      </div>
    </div>

    <!-- Selector de modo -->
    <div class="modo-selector">
      <div class="modo-buttons">
        <button 
          [class.active]="modo === 'crear'"
          (click)="cambiarModo('crear')"
          class="modo-btn"
        >
          üìù Crear Nueva PQR
        </button>
        <button 
          [class.active]="modo === 'consultar'"
          (click)="cambiarModo('consultar')"
          class="modo-btn"
        >
          üîç Consultar Estado
        </button>
      </div>
    </div>

    <!-- Mensajes -->
    <div *ngIf="mensaje" class="mensaje-alerta" [class]="'mensaje-' + mensajeTipo">
      <div class="mensaje-icono">
        <span *ngIf="mensajeTipo === 'success'">‚úÖ</span>
        <span *ngIf="mensajeTipo === 'error'">‚ùå</span>
        <span *ngIf="mensajeTipo === 'info'">‚ÑπÔ∏è</span>
      </div>
      <div class="mensaje-texto">{{ mensaje }}</div>
    </div>

    <!-- Contenido din√°mico -->
    <div class="pqr-content">
      
      <!-- MODO CREAR PQR -->
      <div *ngIf="modo === 'crear'" class="crear-pqr">
        
        <div class="formulario-container">
          <h2 class="formulario-titulo">Crear Nueva PQR</h2>
          <p class="formulario-descripcion">Completa el siguiente formulario para enviar tu PQR. Todos los campos marcados con * son obligatorios.</p>
          
          <form (ngSubmit)="crearPQR()" #pqrForm="ngForm" class="pqr-formulario">
            
            <!-- Tipo de PQR -->
            <div class="form-group">
              <label for="tipo" class="form-label">
                <span class="required">*</span> Tipo de PQR
              </label>
              <div class="tipos-grid">
                <div *ngFor="let tipo of tiposPQR" class="tipo-option">
                  <input
                    type="radio"
                    id="tipo_{{ tipo.valor }}"
                    name="tipo"
                    [(ngModel)]="pqrData.tipo"
                    [value]="tipo.valor"
                    required
                    class="tipo-radio"
                  >
                  <label for="tipo_{{ tipo.valor }}" class="tipo-label">
                    <span class="tipo-icono">{{ obtenerIconoTipo(tipo.valor) }}</span>
                    <span class="tipo-texto">{{ tipo.texto }}</span>
                  </label>
                </div>
              </div>
            </div>
            
            <!-- Informaci√≥n personal -->
            <div class="form-row">
              <div class="form-group">
                <label for="nombre_completo" class="form-label">
                  <span class="required">*</span> Nombre completo
                </label>
                <input
                  type="text"
                  id="nombre_completo"
                  [(ngModel)]="pqrData.nombre_completo"
                  name="nombre_completo"
                  required
                  class="form-input"
                  placeholder=""
                >
              </div>
              
              <div class="form-group">
                <label for="email" class="form-label">
                  <span class="required">*</span> Email
                </label>
                <input
                  type="email"
                  id="email"
                  [(ngModel)]="pqrData.email"
                  name="email"
                  required
                  class="form-input"
                  placeholder="Ej: usuario@email.com"
                >
              </div>
            </div>
            
            <!-- Tel√©fono y Producto -->
            <div class="form-row">
              <div class="form-group">
                <label for="telefono" class="form-label">
                  <span class="required">*</span> Tel√©fono
                </label>
                <input
                  type="tel"
                  id="telefono"
                  [(ngModel)]="pqrData.telefono"
                  name="telefono"
                  required
                  class="form-input"
                  placeholder="Ej: 3001234567"
                >
              </div>
              
              <div class="form-group">
                <label for="producto_relacionado" class="form-label">
                  Producto relacionado (opcional)
                </label>
                <select
                  id="producto_relacionado"
                  [(ngModel)]="pqrData.producto_relacionado"
                  name="producto_relacionado"
                  class="form-select"
                >
                  <option value="">Selecciona un producto</option>
                  <option *ngFor="let producto of productosRelacionados" [value]="producto">
                    {{ producto }}
                  </option>
                </select>
              </div>
            </div>
            
            <!-- Descripci√≥n -->
            <div class="form-group">
              <label for="descripcion" class="form-label">
                <span class="required">*</span> Descripci√≥n detallada
              </label>
              <textarea
                id="descripcion"
                [(ngModel)]="pqrData.descripcion"
                name="descripcion"
                required
                class="form-textarea"
                rows="5"
                placeholder="Describe tu petici√≥n, queja, reclamo o sugerencia con el mayor detalle posible..."
              ></textarea>
              <div class="form-hint">M√°ximo 1000 caracteres</div>
            </div>
            
            <!-- Archivos adjuntos -->
            <div class="form-group">
              <label class="form-label">
                Archivos adjuntos (opcional)
              </label>
              <div class="archivos-info">
                <p class="archivos-descripcion">Puedes adjuntar hasta 5 archivos (PDF, JPG, PNG, DOC, DOCX, XLS, XLSX). M√°ximo 10MB por archivo.</p>
                
                <div class="archivos-upload">
                  <label for="archivos" class="upload-button">
                    <span class="upload-icon">üìé</span>
                    <span class="upload-text">Seleccionar archivos</span>
                    <input
                      type="file"
                      id="archivos"
                      (change)="onFileSelected($event)"
                      multiple
                      accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx"
                      class="upload-input"
                    >
                  </label>
                  <div class="archivos-count">
                    {{ archivos.length }} / 5 archivos seleccionados
                  </div>
                </div>
                
                <!-- Lista de archivos -->
                <div *ngIf="archivos.length > 0" class="archivos-lista">
                  <div *ngFor="let archivo of archivos; let i = index" class="archivo-item">
                    <div class="archivo-info">
                      <span class="archivo-icono">
                        üìÑ
                      </span>
                      <div class="archivo-detalles">
                        <div class="archivo-nombre">{{ archivo.name }}</div>
                        <div class="archivo-tamano">{{ (archivo.size / 1024 / 1024).toFixed(2) }} MB</div>
                      </div>
                    </div>
                    <button
                      type="button"
                      (click)="eliminarArchivo(i)"
                      class="archivo-eliminar"
                    >
                      √ó
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Bot√≥n enviar -->
            <div class="form-actions">
              <button
                type="submit"
                [disabled]="cargando || !pqrData.nombre_completo.trim() || !pqrData.email.trim() || !pqrData.telefono.trim() || !pqrData.descripcion.trim()"
                class="submit-button"
                [class.loading]="cargando"
              >
                <span *ngIf="!cargando">üì§ Enviar PQR</span>
                <span *ngIf="cargando" class="loading-text">
                  <span class="loading-spinner"></span>
                  Enviando...
                </span>
              </button>
              
              <div class="form-nota">
                <p>Al enviar esta PQR, recibir√°s un n√∫mero de ticket √∫nico que podr√°s usar para consultar el estado.</p>
              </div>
            </div>
          </form>
        </div>
        
        <!-- Informaci√≥n adicional -->
        <div class="info-ayuda">
          <h3 class="info-titulo">üìã ¬øC√≥mo crear una PQR efectiva?</h3>
          <ul class="info-lista">
            <li><strong>S√© espec√≠fico:</strong> Describe claramente tu situaci√≥n.</li>
            <li><strong>Proporciona detalles:</strong> Incluye fechas, n√∫meros de pedido, etc.</li>
            <li><strong>Adjunta evidencia:</strong> Fotos, documentos o facturas ayudan.</li>
            <li><strong>Mant√©n un tono respetuoso:</strong> Nos ayuda a resolver mejor.</li>
            <li><strong>Guarda tu n√∫mero de ticket:</strong> Es √∫nico e importante.</li>
          </ul>
          
          <div class="info-contacto">
            <h4>üìû ¬øNecesitas ayuda inmediata?</h4>
            <p>Tambi√©n puedes contactarnos por WhatsApp:</p>
            <div class="contacto-info">
              <div class="contacto-item">üì± +57 (606) 7390968</div>
              <div class="contacto-item">üì± +57 3006680125</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- MODO CONSULTAR PQR -->
      <div *ngIf="modo === 'consultar'" class="consultar-pqr">
        
        <div class="consulta-formulario">
          <h2 class="formulario-titulo">Consultar Estado de PQR</h2>
          <p class="formulario-descripcion">Ingresa tu n√∫mero de ticket para ver el estado y respuestas de tu PQR.</p>
          
          <div class="busqueda-container">
            <div class="busqueda-input-group">
              <input
                type="text"
                [(ngModel)]="numeroTicketConsulta"
                (keyup.enter)="consultarPQR()"
                class="busqueda-input"
                placeholder="Ej: PQR-260105-081"
              >
              <button
                (click)="consultarPQR()"
                [disabled]="cargando || !numeroTicketConsulta.trim()"
                class="busqueda-button"
                [class.loading]="cargando"
              >
                <span *ngIf="!cargando">üîç Buscar</span>
                <span *ngIf="cargando" class="loading-text">
                  <span class="loading-spinner"></span>
                  Buscando...
                </span>
              </button>
            </div>
            <div class="busqueda-hint">
              <p>El n√∫mero de ticket tiene formato: <code>PQR-AAAAMMDD-NNN</code></p>
            </div>
          </div>
        </div>
        
        <!-- Resultado de la consulta -->
        <div *ngIf="pqrConsultada" class="resultado-consulta">
          
          <!-- Tarjeta de resumen -->
          <div class="pqr-resumen">
            <div class="resumen-header">
              <div class="resumen-ticket">
                <span class="ticket-icon">üé´</span>
                <h3 class="ticket-numero">{{ pqrConsultada.numero_ticket }}</h3>
              </div>
              <div class="resumen-estados">
                <div class="estado-badge" [class]="obtenerClaseEstado(pqrConsultada.estado)">
                  <span class="estado-icono">{{ obtenerIconoEstado(pqrConsultada.estado) }}</span>
                  {{ traducirEstado(pqrConsultada.estado) }}
                </div>
                <div class="tipo-badge" [class]="obtenerClaseTipo(pqrConsultada.tipo)">
                  <span class="tipo-icono">{{ obtenerIconoTipo(pqrConsultada.tipo) }}</span>
                  {{ traducirTipo(pqrConsultada.tipo) }}
                </div>
              </div>
            </div>
            
            <div class="resumen-body">
              <div class="resumen-fecha">
                <strong>Fecha de creaci√≥n:</strong> {{ formatearFecha(pqrConsultada.fecha_creacion) }}
              </div>
            <div class="resumen-fecha" *ngIf="pqrConsultada.fecha_actualizacion">
              <strong>√öltima actualizaci√≥n:</strong> {{ formatearFecha(pqrConsultada.fecha_actualizacion) }}
                <div class="info-item">
                  <span class="info-label">üë§ Nombre:</span>
                  <span class="info-valor">{{ pqrConsultada.nombre_completo }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">üìß Email:</span>
                  <span class="info-valor">{{ pqrConsultada.email }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">üì± Tel√©fono:</span>
                  <span class="info-valor">{{ pqrConsultada.telefono }}</span>
                </div>
                <div *ngIf="pqrConsultada.producto_relacionado" class="info-item">
                  <span class="info-label">üì¶ Producto:</span>
                  <span class="info-valor">{{ pqrConsultada.producto_relacionado }}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Descripci√≥n -->
          <div class="pqr-descripcion">
            <h4 class="descripcion-titulo">üìÑ Descripci√≥n</h4>
            <div class="descripcion-contenido">
              {{ pqrConsultada.descripcion }}
            </div>
          </div>
          
          <!-- Archivos adjuntos -->
          <div *ngIf="pqrConsultada.archivos && pqrConsultada.archivos.length > 0" class="pqr-archivos">
            <h4 class="archivos-titulo">üìé Archivos adjuntos</h4>
            <div class="archivos-grid">
              <div *ngFor="let archivo of pqrConsultada.archivos" class="archivo-card">
                <div class="archivo-icono">üìÑ</div>
                <div class="archivo-info">
                  <div class="archivo-nombre">{{ archivo.nombre_archivo }}</div>
                  <div class="archivo-fecha" *ngIf="archivo.fecha_subida">
                    Subido: {{ archivo.fecha_subida }}
                  </div>
                </div>
                <button
                  (click)="descargarArchivo(archivo.url_archivo, archivo.nombre_archivo)"
                  class="archivo-descargar"
                >
                  ‚¨áÔ∏è
                </button>
              </div>
            </div>
          </div>
          
          <!-- Respuestas -->
          <div *ngIf="pqrConsultada.respuestas && pqrConsultada.respuestas.length > 0" class="pqr-respuestas">
            <h4 class="respuestas-titulo">üí¨ Respuestas ({{ pqrConsultada.respuestas.length }})</h4>
            <div class="respuestas-lista">
              <div *ngFor="let respuesta of pqrConsultada.respuestas" class="respuesta-item">
                <div class="respuesta-header">
                  <div class="respuesta-tipo" [class]="respuesta.tipo === 'ADMINISTRACION' ? 'admin' : 'cliente'">
                    {{ respuesta.tipo === 'ADMINISTRACION' ? 'üë®‚Äçüíº Administraci√≥n' : 'üë§ T√∫' }}
                  </div>
                  <div class="respuesta-fecha" *ngIf="respuesta.fecha_respuesta || respuesta.fecha_creacion">
                    {{ formatearFecha(respuesta.fecha_respuesta || respuesta.fecha_creacion) }}
                  </div>
                </div>
                <div class="respuesta-mensaje">
                  {{ respuesta.mensaje }}
                </div>
              </div>
            </div>
          </div>
          
          <!-- Sin respuestas -->
          <div *ngIf="pqrConsultada.respuestas && pqrConsultada.respuestas.length === 0" class="sin-respuestas">
            <div class="sin-respuestas-icono">‚è≥</div>
            <div class="sin-respuestas-texto">
              <h4>Tu PQR est√° siendo revisada</h4>
              <p>No hay respuestas a√∫n. Te notificaremos por email cuando tengamos novedades.</p>
            </div>
          </div>
          
          <!-- Acciones -->
          <div class="pqr-acciones">
            <button (click)="cambiarModo('crear')" class="accion-btn">
              üìù Crear Nueva PQR
            </button>
            <button (click)="consultarPQR()" class="accion-btn secundario">
              üîÑ Actualizar
            </button>
          </div>
        </div>
        
        <!-- Mensaje cuando no hay consulta -->
        <div *ngIf="!pqrConsultada && !cargando" class="sin-consulta">
          <div class="sin-consulta-icono">üîç</div>
          <div class="sin-consulta-texto">
            <h3>Consulta tu PQR</h3>
            <p>Ingresa tu n√∫mero de ticket arriba para ver el estado de tu Petici√≥n, Queja, Reclamo o Sugerencia.</p>
            <div class="sin-consulta-ayuda">
              <p><strong>¬øNo tienes un n√∫mero de ticket?</strong></p>
              <p>Crea una nueva PQR usando el bot√≥n "Crear Nueva PQR" arriba.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>