<div class="description-producto-container">
  
  <!-- Estado de carga -->
  <div *ngIf="cargando" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando detalles del producto...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !cargando" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2 class="error-title">Producto no encontrado</h2>
    <p class="error-message">El producto que buscas no existe o no est√° disponible.</p>
    <button class="error-button" (click)="volverAProductos()">
      Volver a productos
    </button>
  </div>

  <!-- Detalles del producto -->
  <div *ngIf="producto && !cargando && !error" class="producto-detalles">
    
    <!-- Breadcrumb de navegaci√≥n -->
    <nav class="breadcrumb">
      <a routerLink="/productos" class="breadcrumb-link">Productos</a>
      <span class="breadcrumb-separator">‚Ä∫</span>
      <span class="breadcrumb-current">{{nombreCompleto}}</span>
    </nav>

    <!-- Contenedor principal con estructura de dos columnas fijas -->
    <div class="producto-layout-container">
      
      <!-- Columna Izquierda Fija: Imagen y Precio -->
      <div class="producto-columna-izquierda">
        
        <!-- Contenedor de imagen con zoom -->
        <div class="imagen-principal-wrapper">
          <div class="producto-imagen-container"
               (mousemove)="onImageMouseMove($event)"
               (mouseleave)="onImageMouseLeave()">
            <div class="producto-imagen-wrapper">
              <img 
                [src]="producto.imagen_url" 
                [alt]="nombreCompleto" 
                class="producto-imagen"
                [style.--zoom-x]="zoomX + '%'"
                [style.--zoom-y]="zoomY + '%'"
                (error)="producto.imagen_url = 'assets/images/producto-default.jpg'"
              />
              <div class="imagen-overlay-fixed"></div>
              <div class="imagen-zoom-indicator">
                <span class="zoom-icon">üîç</span>
                <span class="zoom-text">Acerca el cursor para hacer zoom</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Precio fijo debajo de la imagen -->
        <div class="precio-fixed-container">
          <div class="precio-fixed-header">
            <span class="precio-fixed-label">Precio:</span>
            <span class="precio-fixed-badge" *ngIf="varianteSeleccionada">Seleccionado</span>
          </div>
          <div class="precio-fixed-valor">
            <span class="precio-numero-fixed">{{formatearPrecio(precioConCantidad)}}</span>
          </div>
          <div class="precio-fixed-nota" *ngIf="variantes.length > 0">
            <small>{{cantidadSeleccionada}} {{cantidadSeleccionada === 1 ? 'unidad' : 'unidades'}} x {{formatearPrecio(precioActual)}}</small>
          </div>
        </div>

        <!-- Acciones r√°pidas en columna izquierda -->
        <div class="acciones-rapidas-container">
          <a [href]="generarWhatsAppLink()"
             target="_blank"
             rel="noopener noreferrer nofollow"
             class="btn-whatsapp-fixed"
             aria-label="Consultar sobre este producto por WhatsApp"
             title="Consultar sobre este producto por WhatsApp">
            <img src="https://res.cloudinary.com/dsv1gdgya/image/upload/v1768854880/whatsapp-logo-whatsapp-logo-transparent-whatsapp-icon-transparent-free-free-png_awplkn.png" alt="WhatsApp" class="btn-icon-img">
            <span class="btn-text-fixed">Consultar por WhatsApp</span>
          </a>
          
          <button class="btn-compartir-fixed" (click)="copiarEnlace()" title="Copiar enlace del producto">
            <svg class="btn-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            <span class="btn-text-fixed">Copiar enlace</span>
          </button>
          
          <div class="mensaje-copiado-fixed" *ngIf="enlaceCopiado">
            ‚úì Enlace copiado al portapapeles
          </div>
        </div>

      </div>

      <!-- Columna Derecha Fija: Informaci√≥n del Producto -->
      <div class="producto-columna-derecha">
        
        <!-- Encabezado -->
        <div class="producto-header-fixed">
          <div class="producto-categorias-fixed">
            <span class="categoria-badge-fixed">{{producto.categoria}}</span>
            <span class="subcategoria-badge-fixed">{{producto.subcategoria}}</span>
          </div>
          <h1 class="producto-nombre-fixed">{{productoBaseNombre}}</h1>
        </div>

        <!-- Contenedor de informaci√≥n SIN SCROLL -->
        <div class="producto-info-container">
          
          <!-- Selecci√≥n de variantes -->
          <div *ngIf="variantes.length > 0" class="opciones-fixed-container">
            <div class="section-header-fixed">
              <h3 class="section-title-fixed">Seleccionar variante</h3>
              <span class="section-subtitle">Selecciona una opci√≥n para actualizar el precio</span>
            </div>
            
            <div class="opciones-fixed-grid">
              <div 
                *ngFor="let variante of variantes" 
                class="opcion-fixed-item"
                [class.opcion-fixed-seleccionada]="varianteSeleccionada?.id === variante.id"
                (click)="seleccionarVariante(variante)">
                <div class="opcion-fixed-contenido">
                  <div class="opcion-fixed-info">
                    <span class="opcion-fixed-texto">{{variante.nombre}}</span>
                    <span class="opcion-fixed-precio">{{formatearPrecio(variante.precio)}}</span>
                  </div>
                  <div class="opcion-fixed-checkbox">
                    <div class="opcion-fixed-checkmark" *ngIf="varianteSeleccionada?.id === variante.id">‚úì</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Selector de cantidad -->
          <div class="cantidad-selector-fixed-section">
            <div class="section-header-fixed">
              <h3 class="section-title-fixed">Seleccionar cantidad</h3>
              <span class="cantidad-actual-badge">{{cantidadSeleccionada}} {{producto.unidad || 'unidades'}}</span>
            </div>
            
            <div class="cantidad-slider-container">
              <input 
                type="range" 
                class="cantidad-slider" 
                min="1" 
                max="10" 
                step="1"
                [value]="cantidadSeleccionada"
                (input)="cambiarCantidad(+$event.target.value)"
              />
              
              <div class="cantidad-labels">
                <span *ngFor="let cantidad of opcionesCantidad" 
                      class="cantidad-label"
                      [class.cantidad-label-activa]="cantidadSeleccionada === cantidad"
                      (click)="cambiarCantidad(cantidad)">
                  {{cantidad}}
                </span>
              </div>
            </div>
            
            <div class="precio-cantidad-display">
              <div class="precio-cantidad-item">
                <span class="precio-cantidad-label">Precio por unidad:</span>
                <span class="precio-cantidad-valor">{{formatearPrecio(precioActual)}}</span>
              </div>
              <div class="precio-cantidad-item">
                <span class="precio-cantidad-label">Cantidad:</span>
                <span class="precio-cantidad-valor">{{cantidadSeleccionada}} {{producto.unidad || 'unidades'}}</span>
              </div>
              <div class="precio-cantidad-item total">
                <span class="precio-cantidad-label">Precio total:</span>
                <span class="precio-cantidad-valor-total">{{formatearPrecio(precioConCantidad)}}</span>
              </div>
            </div>
          </div>

          <!-- Bot√≥n para abrir descripci√≥n en modal -->
          <button class="btn-ver-descripcion" (click)="abrirModalDescripcion()" title="Ver descripci√≥n del producto">
            <span class="btn-descripcion-text">Ver descripci√≥n completa</span>
            <span class="btn-descripcion-icon">‚Üì</span>
          </button>

          <!-- Acciones adicionales -->
          <div class="acciones-adicionales-container">
            <button class="btn-volver-fixed" (click)="volverAProductos()" title="Volver al cat√°logo de productos">
              <span class="btn-icon-fixed">‚Üê</span>
              <span class="btn-text-fixed">Volver</span>
            </button>
            
            <button class="btn-categoria-fixed" (click)="verMasDeEstaCategoria()" *ngIf="producto.categoria" [title]="'Ver m√°s productos de ' + producto.categoria">
              <span class="btn-icon-fixed">‚Üí</span>
              <span class="btn-text-fixed">M√°s de {{producto.categoria}}</span>
            </button>
          </div>

        </div> <!-- Fin del contenedor info -->

      </div> <!-- Fin columna derecha -->

    </div> <!-- Fin layout container -->

  </div> <!-- Fin producto-detalles -->
</div> <!-- Fin description-producto-container -->

<!-- Modal de descripci√≥n -->
<div *ngIf="mostrarModalDescripcion" class="descripcion-modal-backdrop" (click)="cerrarModalDescripcion()">
  <div class="descripcion-modal-container" (click)="$event.stopPropagation()">
    <button class="descripcion-modal-close" (click)="cerrarModalDescripcion()" title="Cerrar (Esc)">
      ‚úï
    </button>
    <div class="descripcion-modal-content">
      <h2 class="descripcion-modal-title">Descripci√≥n del producto</h2>
      <div class="descripcion-modal-text">
        {{descripcionBase || 'Descripci√≥n no disponible'}}
      </div>
      <button class="descripcion-modal-button" (click)="cerrarModalDescripcion()">
        Cerrar
      </button>
    </div>
  </div>
</div>